{"ast":null,"code":"import React,{createContext,useContext,useEffect,useState,useCallback}from'react';import{notificationAPI}from'../services/api';import{jsx as _jsx}from\"react/jsx-runtime\";const NotificationContext=/*#__PURE__*/createContext({active:[],history:[],addNotification:()=>{},dismissNotification:()=>{},clearHistory:()=>{},loadHistory:()=>{}});export const NotificationProvider=_ref=>{let{children}=_ref;const[active,setActive]=useState([]);const[history,setHistory]=useState([]);const[loading,setLoading]=useState(false);// Load notification history from backend when user is authenticated\nconst loadHistory=useCallback(async()=>{const token=localStorage.getItem('token');if(!token){setHistory([]);return;}try{setLoading(true);const response=await notificationAPI.getAll({limit:200});setHistory(response.data||[]);}catch(error){var _error$response;console.error('Failed to load notification history:',error);// If unauthorized, clear history\nif(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===401){setHistory([]);}}finally{setLoading(false);}},[]);// Load history on mount and when token changes\nuseEffect(()=>{loadHistory();// Poll for new notifications every 30 seconds when authenticated\nconst token=localStorage.getItem('token');if(!token)return;const interval=setInterval(loadHistory,30000);return()=>clearInterval(interval);},[loadHistory]);const addNotification=useCallback(async notif=>{const item={id:notif.id||Date.now()+Math.random(),title:notif.title||'Reminder',body:notif.body,time:notif.time||new Date().toISOString(),medicine:notif.medicine||null,scheduleId:notif.scheduleId||null,scheduledTime:notif.scheduledTime||null,createdAt:new Date().toISOString()};// Add to active notifications (in-memory)\nsetActive(prev=>[item,...prev.slice(0,9)]);// Save to backend database\nconst token=localStorage.getItem('token');if(token){try{const response=await notificationAPI.create({title:item.title,body:item.body,medicine:item.medicine,scheduleId:item.scheduleId,scheduledTime:item.scheduledTime});// Update local history with the saved notification (has proper _id from DB)\nsetHistory(prev=>[response.data,...prev].slice(0,200));}catch(error){console.error('Failed to save notification to database:',error);// Still add to local history even if save fails\nsetHistory(prev=>[item,...prev].slice(0,200));}}else{// If not authenticated, just add to local history\nsetHistory(prev=>[item,...prev].slice(0,200));}},[]);const dismissNotification=useCallback(id=>{setActive(prev=>prev.filter(n=>n.id!==id));},[]);const clearHistory=useCallback(async()=>{const token=localStorage.getItem('token');if(token){try{await notificationAPI.clearAll();setHistory([]);}catch(error){console.error('Failed to clear notification history:',error);}}else{setHistory([]);}},[]);return/*#__PURE__*/_jsx(NotificationContext.Provider,{value:{active,history,addNotification,dismissNotification,clearHistory,loadHistory,loading},children:children});};export const useNotifications=()=>useContext(NotificationContext);","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","useCallback","notificationAPI","jsx","_jsx","NotificationContext","active","history","addNotification","dismissNotification","clearHistory","loadHistory","NotificationProvider","_ref","children","setActive","setHistory","loading","setLoading","token","localStorage","getItem","response","getAll","limit","data","error","_error$response","console","status","interval","setInterval","clearInterval","notif","item","id","Date","now","Math","random","title","body","time","toISOString","medicine","scheduleId","scheduledTime","createdAt","prev","slice","create","filter","n","clearAll","Provider","value","useNotifications"],"sources":["C:/a_ITS/Semester 3/Kelas/PemWeb/MediTracker-VibeCoding/frontend/src/context/NotificationContext.js"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState, useCallback } from 'react';\r\nimport { notificationAPI } from '../services/api';\r\n\r\nconst NotificationContext = createContext({\r\n  active: [],\r\n  history: [],\r\n  addNotification: () => {},\r\n  dismissNotification: () => {},\r\n  clearHistory: () => {},\r\n  loadHistory: () => {}\r\n});\r\n\r\nexport const NotificationProvider = ({ children }) => {\r\n  const [active, setActive] = useState([]);\r\n  const [history, setHistory] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  // Load notification history from backend when user is authenticated\r\n  const loadHistory = useCallback(async () => {\r\n    const token = localStorage.getItem('token');\r\n    if (!token) {\r\n      setHistory([]);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n      const response = await notificationAPI.getAll({ limit: 200 });\r\n      setHistory(response.data || []);\r\n    } catch (error) {\r\n      console.error('Failed to load notification history:', error);\r\n      // If unauthorized, clear history\r\n      if (error.response?.status === 401) {\r\n        setHistory([]);\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  // Load history on mount and when token changes\r\n  useEffect(() => {\r\n    loadHistory();\r\n    \r\n    // Poll for new notifications every 30 seconds when authenticated\r\n    const token = localStorage.getItem('token');\r\n    if (!token) return;\r\n    \r\n    const interval = setInterval(loadHistory, 30000);\r\n    return () => clearInterval(interval);\r\n  }, [loadHistory]);\r\n\r\n  const addNotification = useCallback(async (notif) => {\r\n    const item = {\r\n      id: notif.id || (Date.now() + Math.random()),\r\n      title: notif.title || 'Reminder',\r\n      body: notif.body,\r\n      time: notif.time || new Date().toISOString(),\r\n      medicine: notif.medicine || null,\r\n      scheduleId: notif.scheduleId || null,\r\n      scheduledTime: notif.scheduledTime || null,\r\n      createdAt: new Date().toISOString()\r\n    };\r\n    \r\n    // Add to active notifications (in-memory)\r\n    setActive(prev => [item, ...prev.slice(0, 9)]);\r\n    \r\n    // Save to backend database\r\n    const token = localStorage.getItem('token');\r\n    if (token) {\r\n      try {\r\n        const response = await notificationAPI.create({\r\n          title: item.title,\r\n          body: item.body,\r\n          medicine: item.medicine,\r\n          scheduleId: item.scheduleId,\r\n          scheduledTime: item.scheduledTime\r\n        });\r\n        // Update local history with the saved notification (has proper _id from DB)\r\n        setHistory(prev => [response.data, ...prev].slice(0, 200));\r\n      } catch (error) {\r\n        console.error('Failed to save notification to database:', error);\r\n        // Still add to local history even if save fails\r\n        setHistory(prev => [item, ...prev].slice(0, 200));\r\n      }\r\n    } else {\r\n      // If not authenticated, just add to local history\r\n      setHistory(prev => [item, ...prev].slice(0, 200));\r\n    }\r\n  }, []);\r\n\r\n  const dismissNotification = useCallback((id) => {\r\n    setActive(prev => prev.filter(n => n.id !== id));\r\n  }, []);\r\n\r\n  const clearHistory = useCallback(async () => {\r\n    const token = localStorage.getItem('token');\r\n    if (token) {\r\n      try {\r\n        await notificationAPI.clearAll();\r\n        setHistory([]);\r\n      } catch (error) {\r\n        console.error('Failed to clear notification history:', error);\r\n      }\r\n    } else {\r\n      setHistory([]);\r\n    }\r\n  }, []);\r\n\r\n  return (\r\n    <NotificationContext.Provider value={{ active, history, addNotification, dismissNotification, clearHistory, loadHistory, loading }}>\r\n      {children}\r\n    </NotificationContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useNotifications = () => useContext(NotificationContext);\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}